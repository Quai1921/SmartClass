/* ========================================
   CONTAINER STYLES
   ======================================== */

/* Base container styles */
.element-container {
  position: relative;
  min-height: 100px;
  min-width: 200px;
  border: 3px dashed #e5e7eb;
  border-radius: 12px;
  padding: 16px;
  background: rgba(249, 250, 251, 0.8);
  transition: all 0.2s ease;
  box-sizing: border-box;
  overflow: visible;
  /* Ensure container can contain absolutely positioned children */
  contain: layout;
}

.element-container:hover {
  border-color: #9ca3af;
  background: rgba(243, 244, 246, 0.9);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.element-container.selected {
  border: 3px solid #3b82f6 !important;
  box-shadow: 
    0 0 0 1px rgba(59, 130, 246, 0.2),
    0 2px 8px rgba(59, 130, 246, 0.15) !important;
}

/* Container drop zones */
.container-dropzone {
  min-height: 60px;
  position: relative;
  /* Let inline styles control display and flex properties */
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  overflow: visible;
  /* Prevent dropzone from expanding beyond parent container */
  max-width: 100%;
  margin: 0; /* Ensure no margin */
  padding: 0; /* Ensure no padding */
  /* Ensure absolutely positioned children are contained within */
  contain: layout;
}

.container-dropzone.empty {
  border: 2px dashed #d1d5db;
  border-radius: 6px;
  background: rgba(249, 250, 251, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  color: #6b7280;
  font-size: 14px;
  font-style: italic;
  min-height: 80px;
}

.container-dropzone.empty::after {
  content: "Drop elements here";
  pointer-events: none;
}

.container-dropzone.drag-over {
  border-color: #3b82f6;
  background: rgba(239, 246, 255, 0.5);
}

/* Grid layout containers */
.container-dropzone.grid-layout {
  display: grid;
  gap: 12px;
  grid-template-columns: repeat(var(--grid-columns, 2), 1fr);
  grid-template-rows: repeat(var(--grid-rows, auto), auto);
  min-height: 120px;
}

.container-dropzone.grid-layout.empty::after {
  content: "Drop elements into grid cells";
  grid-column: 1 / -1;
  grid-row: 1 / -1;
}

/* Flex layout containers */
.container-dropzone.flex-layout {
  display: flex;
  gap: 12px;
}

.container-dropzone.flex-layout.horizontal {
  flex-direction: row;
  align-items: flex-start;
}

.container-dropzone.flex-layout.vertical {
  flex-direction: column;
  align-items: stretch;
}

/* Grid overlay for drag operations */
.grid-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 100;
}

.grid-overlay .grid-cell {
  position: absolute;
  border: 1px solid rgba(59, 130, 246, 0.3);
  background: rgba(239, 246, 255, 0.1);
  transition: all 0.15s ease;
}

.grid-overlay .grid-cell.target {
  border-color: #3b82f6;
  background: rgba(59, 130, 246, 0.2);
  box-shadow: inset 0 0 0 2px rgba(59, 130, 246, 0.4);
}

/* Parent containers must not clip child handles */
.container-dropzone:has(.widget-resizable.selected) {
  overflow: visible !important;
  z-index: 50 !important;
}

.container-dropzone:has(.element-wrapper.element-container.selected) {
  overflow: visible !important;
  z-index: 50 !important;
}

/* ========================================
   RESIZABLE CONTAINER STYLES
   ======================================== */

/* Base resizable container styles */
.resizable-container {
  box-sizing: border-box;
  border: 2px solid transparent;
  border-radius: 8px;
  transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
  outline: none;
  position: relative; /* Parent containers are relative */
  /* Remove block display for freeform */
}

.resizable-container > .resizable-container {
  position: absolute; /* Children are absolutely positioned */
  /* Remove margin, block, etc. */
}

/* Ultra-specific override to ensure container inline styles are respected */
/* Remove aggressive width overrides - let inline styles work naturally */

/* Ensure no Tailwind or other utility classes override container dimensions */
.page-builder .resizable-container.container,
.page-builder div.resizable-container.container {
  max-width: none !important;
  min-width: 100px !important;
}

/* Prevent any global width utilities from affecting containers */
.resizable-container.container.w-full {
  width: auto !important;
}

/* Container hover state */
.resizable-container:hover {
  border-color: rgba(59, 130, 246, 0.4);
  box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.15);
}

/* Selected container - more prominent but not overwhelming */
.resizable-container.selected {
  border-color: #3b82f6 !important;
  border-width: 3px !important;
  box-shadow: 
    0 0 0 1px rgba(59, 130, 246, 0.3),
    0 2px 8px rgba(59, 130, 246, 0.15) !important;
  z-index: 50 !important;
}

/* Container being resized */
.resizable-container.resizing {
  border-color: #2563eb !important;
  border-width: 3px !important;
  box-shadow: 
    0 0 0 1px rgba(37, 99, 235, 0.4),
    0 4px 12px rgba(59, 130, 246, 0.2) !important;
  background: rgba(219, 234, 254, 0.08) !important;
  z-index: 100 !important;
}

/* Container being repositioned */
.resizable-container.repositioning {
  border-color: #10b981 !important;
  border-width: 3px !important;
  box-shadow: 
    0 0 0 1px rgba(16, 185, 129, 0.4),
    0 4px 12px rgba(16, 185, 129, 0.2) !important;
  background: rgba(209, 250, 229, 0.08) !important;
  z-index: 100 !important;
}

/* Ensure containers don't clip their resize handles */
.resizable-container.selected,
.resizable-container.resizing,
.resizable-container.repositioning {
  overflow: visible !important;
}

/* Child container visibility styles */
.resizable-container[data-element-id] {
  /* Add subtle visual indicators for child containers */
  border: 1px dashed rgba(156, 163, 175, 0.4);
  border-radius: 6px;
  background: rgba(249, 250, 251, 0.3);
  transition: all 0.2s ease;
}

.resizable-container[data-element-id]:hover {
  border-color: rgba(156, 163, 175, 0.6);
  background: rgba(249, 250, 251, 0.5);
}

.resizable-container[data-element-id].selected {
  border: 2px solid #3b82f6 !important;
  box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.2);
}

/* Main containers (no parent) should have stronger visual */
.resizable-container[data-element-id]:not([data-parent-id]) {
  border: 2px dashed #d1d5db;
  background: rgba(249, 250, 251, 0.6);
}

.resizable-container[data-element-id]:not([data-parent-id]):hover {
  border-color: #9ca3af;
  background: rgba(243, 244, 246, 0.8);
}

/* Background image support for resizable containers */
.resizable-container.has-background-image {
  background-attachment: scroll !important;
  background-clip: border-box !important;
  background-origin: padding-box !important;
}

/* Ensure containers with background images have sufficient height */
.resizable-container.has-background-image {
  min-height: 200px !important;
}

/* Force background image display */
.resizable-container[style*="background-image"] {
  background-attachment: scroll !important;
  background-clip: border-box !important;
}
